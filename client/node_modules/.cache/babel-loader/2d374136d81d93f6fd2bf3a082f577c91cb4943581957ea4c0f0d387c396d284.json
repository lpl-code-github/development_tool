{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport hash from '@emotion/hash';\nimport { ATTR_TOKEN, CSS_IN_JS_INSTANCE, CSS_IN_JS_INSTANCE_ID } from '../StyleContext';\nimport useGlobalCache from './useGlobalCache';\nimport { flattenToken, token2key } from '../util';\nimport { ref, computed } from 'vue';\nconst EMPTY_OVERRIDE = {};\n// Generate different prefix to make user selector break in production env.\n// This helps developer not to do style override directly on the hash id.\nconst hashPrefix = process.env.NODE_ENV !== 'production' ? 'css-dev-only-do-not-override' : 'css';\nconst tokenKeys = new Map();\nfunction recordCleanToken(tokenKey) {\n  tokenKeys.set(tokenKey, (tokenKeys.get(tokenKey) || 0) + 1);\n}\nfunction removeStyleTags(key) {\n  if (typeof document !== 'undefined') {\n    const styles = document.querySelectorAll(`style[${ATTR_TOKEN}=\"${key}\"]`);\n    styles.forEach(style => {\n      var _a;\n      if (style[CSS_IN_JS_INSTANCE] === CSS_IN_JS_INSTANCE_ID) {\n        (_a = style.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(style);\n      }\n    });\n  }\n}\n// Remove will check current keys first\nfunction cleanTokenStyle(tokenKey) {\n  tokenKeys.set(tokenKey, (tokenKeys.get(tokenKey) || 0) - 1);\n  const tokenKeyList = Array.from(tokenKeys.keys());\n  const cleanableKeyList = tokenKeyList.filter(key => {\n    const count = tokenKeys.get(key) || 0;\n    return count <= 0;\n  });\n  if (cleanableKeyList.length < tokenKeyList.length) {\n    cleanableKeyList.forEach(key => {\n      removeStyleTags(key);\n      tokenKeys.delete(key);\n    });\n  }\n}\n/**\n * Cache theme derivative token as global shared one\n * @param theme Theme entity\n * @param tokens List of tokens, used for cache. Please do not dynamic generate object directly\n * @param option Additional config\n * @returns Call Theme.getDerivativeToken(tokenObject) to get token\n */\nexport default function useCacheToken(theme, tokens) {\n  let option = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ref({});\n  // Basic - We do basic cache here\n  const mergedToken = computed(() => _extends({}, ...tokens.value));\n  const tokenStr = computed(() => flattenToken(mergedToken.value));\n  const overrideTokenStr = computed(() => flattenToken(option.value.override || EMPTY_OVERRIDE));\n  const cachedToken = useGlobalCache('token', computed(() => [option.value.salt || '', theme.value.id, tokenStr.value, overrideTokenStr.value]), () => {\n    const {\n      salt = '',\n      override = EMPTY_OVERRIDE,\n      formatToken\n    } = option.value;\n    const derivativeToken = theme.value.getDerivativeToken(mergedToken.value);\n    // Merge with override\n    let mergedDerivativeToken = _extends(_extends({}, derivativeToken), override);\n    // Format if needed\n    if (formatToken) {\n      mergedDerivativeToken = formatToken(mergedDerivativeToken);\n    }\n    // Optimize for `useStyleRegister` performance\n    const tokenKey = token2key(mergedDerivativeToken, salt);\n    mergedDerivativeToken._tokenKey = tokenKey;\n    recordCleanToken(tokenKey);\n    const hashId = `${hashPrefix}-${hash(tokenKey)}`;\n    mergedDerivativeToken._hashId = hashId; // Not used\n    return [mergedDerivativeToken, hashId];\n  }, cache => {\n    // Remove token will remove all related style\n    cleanTokenStyle(cache[0]._tokenKey);\n  });\n  return cachedToken;\n}","map":{"version":3,"names":["_extends","hash","ATTR_TOKEN","CSS_IN_JS_INSTANCE","CSS_IN_JS_INSTANCE_ID","useGlobalCache","flattenToken","token2key","ref","computed","EMPTY_OVERRIDE","hashPrefix","process","env","NODE_ENV","tokenKeys","Map","recordCleanToken","tokenKey","set","get","removeStyleTags","key","document","styles","querySelectorAll","forEach","style","_a","parentNode","removeChild","cleanTokenStyle","tokenKeyList","Array","from","keys","cleanableKeyList","filter","count","length","delete","useCacheToken","theme","tokens","option","arguments","undefined","mergedToken","value","tokenStr","overrideTokenStr","override","cachedToken","salt","id","formatToken","derivativeToken","getDerivativeToken","mergedDerivativeToken","_tokenKey","hashId","_hashId","cache"],"sources":["/Users/lpl/工作/Teamsupport/develop_help/node_modules/ant-design-vue/es/_util/cssinjs/hooks/useCacheToken.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport hash from '@emotion/hash';\nimport { ATTR_TOKEN, CSS_IN_JS_INSTANCE, CSS_IN_JS_INSTANCE_ID } from '../StyleContext';\nimport useGlobalCache from './useGlobalCache';\nimport { flattenToken, token2key } from '../util';\nimport { ref, computed } from 'vue';\nconst EMPTY_OVERRIDE = {};\n// Generate different prefix to make user selector break in production env.\n// This helps developer not to do style override directly on the hash id.\nconst hashPrefix = process.env.NODE_ENV !== 'production' ? 'css-dev-only-do-not-override' : 'css';\nconst tokenKeys = new Map();\nfunction recordCleanToken(tokenKey) {\n  tokenKeys.set(tokenKey, (tokenKeys.get(tokenKey) || 0) + 1);\n}\nfunction removeStyleTags(key) {\n  if (typeof document !== 'undefined') {\n    const styles = document.querySelectorAll(`style[${ATTR_TOKEN}=\"${key}\"]`);\n    styles.forEach(style => {\n      var _a;\n      if (style[CSS_IN_JS_INSTANCE] === CSS_IN_JS_INSTANCE_ID) {\n        (_a = style.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(style);\n      }\n    });\n  }\n}\n// Remove will check current keys first\nfunction cleanTokenStyle(tokenKey) {\n  tokenKeys.set(tokenKey, (tokenKeys.get(tokenKey) || 0) - 1);\n  const tokenKeyList = Array.from(tokenKeys.keys());\n  const cleanableKeyList = tokenKeyList.filter(key => {\n    const count = tokenKeys.get(key) || 0;\n    return count <= 0;\n  });\n  if (cleanableKeyList.length < tokenKeyList.length) {\n    cleanableKeyList.forEach(key => {\n      removeStyleTags(key);\n      tokenKeys.delete(key);\n    });\n  }\n}\n/**\n * Cache theme derivative token as global shared one\n * @param theme Theme entity\n * @param tokens List of tokens, used for cache. Please do not dynamic generate object directly\n * @param option Additional config\n * @returns Call Theme.getDerivativeToken(tokenObject) to get token\n */\nexport default function useCacheToken(theme, tokens) {\n  let option = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ref({});\n  // Basic - We do basic cache here\n  const mergedToken = computed(() => _extends({}, ...tokens.value));\n  const tokenStr = computed(() => flattenToken(mergedToken.value));\n  const overrideTokenStr = computed(() => flattenToken(option.value.override || EMPTY_OVERRIDE));\n  const cachedToken = useGlobalCache('token', computed(() => [option.value.salt || '', theme.value.id, tokenStr.value, overrideTokenStr.value]), () => {\n    const {\n      salt = '',\n      override = EMPTY_OVERRIDE,\n      formatToken\n    } = option.value;\n    const derivativeToken = theme.value.getDerivativeToken(mergedToken.value);\n    // Merge with override\n    let mergedDerivativeToken = _extends(_extends({}, derivativeToken), override);\n    // Format if needed\n    if (formatToken) {\n      mergedDerivativeToken = formatToken(mergedDerivativeToken);\n    }\n    // Optimize for `useStyleRegister` performance\n    const tokenKey = token2key(mergedDerivativeToken, salt);\n    mergedDerivativeToken._tokenKey = tokenKey;\n    recordCleanToken(tokenKey);\n    const hashId = `${hashPrefix}-${hash(tokenKey)}`;\n    mergedDerivativeToken._hashId = hashId; // Not used\n    return [mergedDerivativeToken, hashId];\n  }, cache => {\n    // Remove token will remove all related style\n    cleanTokenStyle(cache[0]._tokenKey);\n  });\n  return cachedToken;\n}"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,oCAAoC;AACzD,OAAOC,IAAI,MAAM,eAAe;AAChC,SAASC,UAAU,EAAEC,kBAAkB,EAAEC,qBAAqB,QAAQ,iBAAiB;AACvF,OAAOC,cAAc,MAAM,kBAAkB;AAC7C,SAASC,YAAY,EAAEC,SAAS,QAAQ,SAAS;AACjD,SAASC,GAAG,EAAEC,QAAQ,QAAQ,KAAK;AACnC,MAAMC,cAAc,GAAG,CAAC,CAAC;AACzB;AACA;AACA,MAAMC,UAAU,GAAGC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,GAAG,8BAA8B,GAAG,KAAK;AACjG,MAAMC,SAAS,GAAG,IAAIC,GAAG,CAAC,CAAC;AAC3B,SAASC,gBAAgBA,CAACC,QAAQ,EAAE;EAClCH,SAAS,CAACI,GAAG,CAACD,QAAQ,EAAE,CAACH,SAAS,CAACK,GAAG,CAACF,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC7D;AACA,SAASG,eAAeA,CAACC,GAAG,EAAE;EAC5B,IAAI,OAAOC,QAAQ,KAAK,WAAW,EAAE;IACnC,MAAMC,MAAM,GAAGD,QAAQ,CAACE,gBAAgB,CAAE,SAAQvB,UAAW,KAAIoB,GAAI,IAAG,CAAC;IACzEE,MAAM,CAACE,OAAO,CAACC,KAAK,IAAI;MACtB,IAAIC,EAAE;MACN,IAAID,KAAK,CAACxB,kBAAkB,CAAC,KAAKC,qBAAqB,EAAE;QACvD,CAACwB,EAAE,GAAGD,KAAK,CAACE,UAAU,MAAM,IAAI,IAAID,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACE,WAAW,CAACH,KAAK,CAAC;MACpF;IACF,CAAC,CAAC;EACJ;AACF;AACA;AACA,SAASI,eAAeA,CAACb,QAAQ,EAAE;EACjCH,SAAS,CAACI,GAAG,CAACD,QAAQ,EAAE,CAACH,SAAS,CAACK,GAAG,CAACF,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;EAC3D,MAAMc,YAAY,GAAGC,KAAK,CAACC,IAAI,CAACnB,SAAS,CAACoB,IAAI,CAAC,CAAC,CAAC;EACjD,MAAMC,gBAAgB,GAAGJ,YAAY,CAACK,MAAM,CAACf,GAAG,IAAI;IAClD,MAAMgB,KAAK,GAAGvB,SAAS,CAACK,GAAG,CAACE,GAAG,CAAC,IAAI,CAAC;IACrC,OAAOgB,KAAK,IAAI,CAAC;EACnB,CAAC,CAAC;EACF,IAAIF,gBAAgB,CAACG,MAAM,GAAGP,YAAY,CAACO,MAAM,EAAE;IACjDH,gBAAgB,CAACV,OAAO,CAACJ,GAAG,IAAI;MAC9BD,eAAe,CAACC,GAAG,CAAC;MACpBP,SAAS,CAACyB,MAAM,CAAClB,GAAG,CAAC;IACvB,CAAC,CAAC;EACJ;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASmB,aAAaA,CAACC,KAAK,EAAEC,MAAM,EAAE;EACnD,IAAIC,MAAM,GAAGC,SAAS,CAACN,MAAM,GAAG,CAAC,IAAIM,SAAS,CAAC,CAAC,CAAC,KAAKC,SAAS,GAAGD,SAAS,CAAC,CAAC,CAAC,GAAGrC,GAAG,CAAC,CAAC,CAAC,CAAC;EACxF;EACA,MAAMuC,WAAW,GAAGtC,QAAQ,CAAC,MAAMT,QAAQ,CAAC,CAAC,CAAC,EAAE,GAAG2C,MAAM,CAACK,KAAK,CAAC,CAAC;EACjE,MAAMC,QAAQ,GAAGxC,QAAQ,CAAC,MAAMH,YAAY,CAACyC,WAAW,CAACC,KAAK,CAAC,CAAC;EAChE,MAAME,gBAAgB,GAAGzC,QAAQ,CAAC,MAAMH,YAAY,CAACsC,MAAM,CAACI,KAAK,CAACG,QAAQ,IAAIzC,cAAc,CAAC,CAAC;EAC9F,MAAM0C,WAAW,GAAG/C,cAAc,CAAC,OAAO,EAAEI,QAAQ,CAAC,MAAM,CAACmC,MAAM,CAACI,KAAK,CAACK,IAAI,IAAI,EAAE,EAAEX,KAAK,CAACM,KAAK,CAACM,EAAE,EAAEL,QAAQ,CAACD,KAAK,EAAEE,gBAAgB,CAACF,KAAK,CAAC,CAAC,EAAE,MAAM;IACnJ,MAAM;MACJK,IAAI,GAAG,EAAE;MACTF,QAAQ,GAAGzC,cAAc;MACzB6C;IACF,CAAC,GAAGX,MAAM,CAACI,KAAK;IAChB,MAAMQ,eAAe,GAAGd,KAAK,CAACM,KAAK,CAACS,kBAAkB,CAACV,WAAW,CAACC,KAAK,CAAC;IACzE;IACA,IAAIU,qBAAqB,GAAG1D,QAAQ,CAACA,QAAQ,CAAC,CAAC,CAAC,EAAEwD,eAAe,CAAC,EAAEL,QAAQ,CAAC;IAC7E;IACA,IAAII,WAAW,EAAE;MACfG,qBAAqB,GAAGH,WAAW,CAACG,qBAAqB,CAAC;IAC5D;IACA;IACA,MAAMxC,QAAQ,GAAGX,SAAS,CAACmD,qBAAqB,EAAEL,IAAI,CAAC;IACvDK,qBAAqB,CAACC,SAAS,GAAGzC,QAAQ;IAC1CD,gBAAgB,CAACC,QAAQ,CAAC;IAC1B,MAAM0C,MAAM,GAAI,GAAEjD,UAAW,IAAGV,IAAI,CAACiB,QAAQ,CAAE,EAAC;IAChDwC,qBAAqB,CAACG,OAAO,GAAGD,MAAM,CAAC,CAAC;IACxC,OAAO,CAACF,qBAAqB,EAAEE,MAAM,CAAC;EACxC,CAAC,EAAEE,KAAK,IAAI;IACV;IACA/B,eAAe,CAAC+B,KAAK,CAAC,CAAC,CAAC,CAACH,SAAS,CAAC;EACrC,CAAC,CAAC;EACF,OAAOP,WAAW;AACpB"},"metadata":{},"sourceType":"module","externalDependencies":[]}