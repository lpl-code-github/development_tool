{"ast":null,"code":"import { postDatabaseBackup } from \"@/api/request\";\nexport default {\n  name: \"AddBackUp\",\n  props: {\n    openFlag: {\n      type: Boolean,\n      required: true\n    },\n    dbList: {\n      type: Array,\n      required: true\n    }\n  },\n  data() {\n    return {\n      loading: false,\n      visible: false,\n      formLayout: 'horizontal',\n      form: {\n        name: '',\n        desc: '',\n        db: ''\n      },\n      // 表单的值\n      rules: {\n        name: [{\n          required: true,\n          message: '请输入操作名称',\n          trigger: 'blur'\n        }, {\n          min: 5,\n          max: 50,\n          message: '长度必须在 5 ～ 50',\n          trigger: 'blur'\n        }],\n        db: [{\n          required: true,\n          message: '请选择数据库',\n          trigger: 'blur'\n        }]\n      } // 表格校验规则\n    };\n  },\n\n  watch: {\n    openFlag: {\n      handler: function (newVal, oldVal) {\n        // 将父组件的值拷贝一份\n        this.visible = newVal;\n      },\n      // 深度观察监听\n      deep: true\n    }\n  },\n  mounted() {\n    this.visible = this.openFlag;\n  },\n  methods: {\n    /*\n      表单提交\n     */\n    handleOk(e) {\n      this.loading = true;\n      this.$refs.ruleForm.validate(valid => {\n        if (valid) {\n          var data = {\n            data: this.form\n          };\n          var message = this.$message;\n          var loadingMessage = message.loading('正在备份数据库，该操作有点耗时，请等待....', 0);\n          this.$request.postDatabaseBackup(data).then(res => {\n            if (res.status === 200) {\n              setTimeout(loadingMessage, 0);\n              message.success(\"备份成功\");\n              // 请求成功后 将新增的值传给父组件\n              this.$emit('submit', res.data.data);\n            } else {\n              setTimeout(loadingMessage, 0);\n            }\n          });\n          this.initFormData();\n          setTimeout(() => {\n            // 告诉父组件可以关闭了\n            this.$emit('updateModelStatus', false);\n            this.loading = false;\n          }, 1);\n        } else {\n          this.loading = false;\n          return false;\n        }\n      });\n    },\n    /*\n      modal关闭事件\n     */\n    handleCancel(e) {\n      this.initFormData();\n      // 告诉父组件可以关闭了\n      this.$emit('updateModelStatus', false);\n    },\n    afterClose(e) {\n      this.initFormData();\n      // 告诉父组件可以关闭了\n      this.$emit('updateModelStatus', false);\n    },\n    // select选择器 搜索功能\n    filterOption(input, option) {\n      return option.componentOptions.children[0].text.toLowerCase().indexOf(input.toLowerCase()) >= 0;\n    },\n    // 重置表单\n    initFormData() {\n      this.$refs.ruleForm.resetFields();\n    }\n  }\n};","map":{"version":3,"names":["postDatabaseBackup","name","props","openFlag","type","Boolean","required","dbList","Array","data","loading","visible","formLayout","form","desc","db","rules","message","trigger","min","max","watch","handler","newVal","oldVal","deep","mounted","methods","handleOk","e","$refs","ruleForm","validate","valid","$message","loadingMessage","$request","then","res","status","setTimeout","success","$emit","initFormData","handleCancel","afterClose","filterOption","input","option","componentOptions","children","text","toLowerCase","indexOf","resetFields"],"sources":["src/components/backup/AddBackUp.vue"],"sourcesContent":["<template>\n  <div>\n    <a-modal v-model=\"visible\" title=\"备份数据库\" on-ok=\"handleOk\"  :afterClose=\"afterClose\" :maskClosable=\"false\">\n      <template slot=\"footer\">\n        <a-button key=\"back\" @click=\"handleCancel\">\n          取消\n        </a-button>\n        <a-button key=\"submit\" type=\"primary\" :loading=\"loading\" @click=\"handleOk\">\n          提交\n        </a-button>\n      </template>\n      <a-form-model\n          ref=\"ruleForm\"\n          :model=\"form\"\n          :rules=\"rules\"\n          :label-col=\"{ span: 3 }\"\n          :wrapper-col=\"{ span: 20}\"\n          style=\"width: 100%\">\n        <a-form-model-item ref=\"name\" label=\"名称\" prop=\"name\">\n          <a-input v-model=\"form.name\"/>\n        </a-form-model-item>\n        <a-form-model-item label=\"描述\" prop=\"desc\">\n          <a-input v-model=\"form.desc\" rows=\"4\" type=\"textarea\"/>\n        </a-form-model-item>\n        <a-form-model-item label=\"DB\" prop=\"db\">\n          <a-select\n              show-search\n              placeholder=\"选择数据库\"\n              option-filter-prop=\"children\"\n              :filter-option=\"filterOption\"\n              v-model=\"form.db\"\n          >\n            <a-select-option v-for=\"(item,index) in dbList\" :key=\"index\" :value=\"item\">\n              {{ item }}\n            </a-select-option>\n          </a-select>\n        </a-form-model-item>\n      </a-form-model>\n    </a-modal>\n  </div>\n</template>\n<script>\nimport {postDatabaseBackup} from \"@/api/request\";\n\nexport default {\n  name: \"AddBackUp\",\n  props: {\n    openFlag: {\n      type: Boolean,\n      required: true\n    },\n    dbList: {\n      type: Array,\n      required: true\n    },\n  },\n  data() {\n    return {\n      loading: false,\n      visible: false,\n      formLayout: 'horizontal',\n      form: {\n        name: '',\n        desc: '',\n        db: ''\n      }, // 表单的值\n      rules: {\n        name: [\n          {required: true, message: '请输入操作名称', trigger: 'blur'},\n          {min: 5, max: 50, message: '长度必须在 5 ～ 50', trigger: 'blur'},\n        ],\n        db: [\n          {required: true, message: '请选择数据库', trigger: 'blur'},\n        ],\n      }, // 表格校验规则\n    };\n  },\n  watch: {\n    openFlag: {\n      handler: function (newVal, oldVal) {\n        // 将父组件的值拷贝一份\n        this.visible = newVal\n      },\n      // 深度观察监听\n      deep: true\n    }\n  },\n  mounted() {\n    this.visible = this.openFlag\n  },\n  methods: {\n    /*\n      表单提交\n     */\n    handleOk(e) {\n      this.loading = true;\n      this.$refs.ruleForm.validate(valid => {\n        if (valid) {\n          var data = {\n            data:this.form\n          }\n          var message = this.$message\n          var loadingMessage = message.loading('正在备份数据库，该操作有点耗时，请等待....', 0)\n          this.$request.postDatabaseBackup(data).then(res=>{\n            if (res.status === 200){\n              setTimeout(loadingMessage, 0);\n              message.success(\"备份成功\")\n              // 请求成功后 将新增的值传给父组件\n              this.$emit('submit', res.data.data)\n            }else {\n              setTimeout(loadingMessage, 0);\n            }\n          })\n          this.initFormData()\n          setTimeout(() => {\n            // 告诉父组件可以关闭了\n            this.$emit('updateModelStatus', false)\n            this.loading = false;\n          }, 1);\n        } else {\n          this.loading = false\n          return false\n        }\n      });\n    },\n\n    /*\n      modal关闭事件\n     */\n    handleCancel(e) {\n      this.initFormData()\n      // 告诉父组件可以关闭了\n      this.$emit('updateModelStatus', false)\n    },\n    afterClose(e) {\n      this.initFormData()\n      // 告诉父组件可以关闭了\n      this.$emit('updateModelStatus', false)\n    },\n\n    // select选择器 搜索功能\n    filterOption(input, option) {\n      return (\n          option.componentOptions.children[0].text.toLowerCase().indexOf(input.toLowerCase()) >= 0\n      );\n    },\n    // 重置表单\n    initFormData() {\n      this.$refs.ruleForm.resetFields();\n    }\n  },\n};\n</script>\n<style scoped>\n/deep/ .ant-modal-body{\n  max-height: 400px;\n  overflow-y: auto;\n}\n</style>\n"],"mappings":"AA0CA,SAAAA,kBAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACAC,QAAA;MACAC,IAAA,EAAAC,OAAA;MACAC,QAAA;IACA;IACAC,MAAA;MACAH,IAAA,EAAAI,KAAA;MACAF,QAAA;IACA;EACA;EACAG,KAAA;IACA;MACAC,OAAA;MACAC,OAAA;MACAC,UAAA;MACAC,IAAA;QACAZ,IAAA;QACAa,IAAA;QACAC,EAAA;MACA;MAAA;MACAC,KAAA;QACAf,IAAA,GACA;UAAAK,QAAA;UAAAW,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAC,GAAA;UAAAC,GAAA;UAAAH,OAAA;UAAAC,OAAA;QAAA,EACA;QACAH,EAAA,GACA;UAAAT,QAAA;UAAAW,OAAA;UAAAC,OAAA;QAAA;MAEA;IACA;EACA;;EACAG,KAAA;IACAlB,QAAA;MACAmB,OAAA,WAAAA,CAAAC,MAAA,EAAAC,MAAA;QACA;QACA,KAAAb,OAAA,GAAAY,MAAA;MACA;MACA;MACAE,IAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAf,OAAA,QAAAR,QAAA;EACA;EACAwB,OAAA;IACA;AACA;AACA;IACAC,SAAAC,CAAA;MACA,KAAAnB,OAAA;MACA,KAAAoB,KAAA,CAAAC,QAAA,CAAAC,QAAA,CAAAC,KAAA;QACA,IAAAA,KAAA;UACA,IAAAxB,IAAA;YACAA,IAAA,OAAAI;UACA;UACA,IAAAI,OAAA,QAAAiB,QAAA;UACA,IAAAC,cAAA,GAAAlB,OAAA,CAAAP,OAAA;UACA,KAAA0B,QAAA,CAAApC,kBAAA,CAAAS,IAAA,EAAA4B,IAAA,CAAAC,GAAA;YACA,IAAAA,GAAA,CAAAC,MAAA;cACAC,UAAA,CAAAL,cAAA;cACAlB,OAAA,CAAAwB,OAAA;cACA;cACA,KAAAC,KAAA,WAAAJ,GAAA,CAAA7B,IAAA,CAAAA,IAAA;YACA;cACA+B,UAAA,CAAAL,cAAA;YACA;UACA;UACA,KAAAQ,YAAA;UACAH,UAAA;YACA;YACA,KAAAE,KAAA;YACA,KAAAhC,OAAA;UACA;QACA;UACA,KAAAA,OAAA;UACA;QACA;MACA;IACA;IAEA;AACA;AACA;IACAkC,aAAAf,CAAA;MACA,KAAAc,YAAA;MACA;MACA,KAAAD,KAAA;IACA;IACAG,WAAAhB,CAAA;MACA,KAAAc,YAAA;MACA;MACA,KAAAD,KAAA;IACA;IAEA;IACAI,aAAAC,KAAA,EAAAC,MAAA;MACA,OACAA,MAAA,CAAAC,gBAAA,CAAAC,QAAA,IAAAC,IAAA,CAAAC,WAAA,GAAAC,OAAA,CAAAN,KAAA,CAAAK,WAAA;IAEA;IACA;IACAT,aAAA;MACA,KAAAb,KAAA,CAAAC,QAAA,CAAAuB,WAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}