{"ast":null,"code":"import { onBeforeUnmount, onMounted, watch, shallowRef, computed } from 'vue';\nimport KeyCode from '../../_util/KeyCode';\nimport { addGlobalMousedownEvent, getTargetFromEvent } from '../utils/uiUtil';\nimport raf from '../../_util/raf';\nexport default function usePickerInput(_ref) {\n  let {\n    open,\n    value,\n    isClickOutside,\n    triggerOpen,\n    forwardKeydown,\n    onKeydown,\n    blurToCancel,\n    onSubmit,\n    onCancel,\n    onFocus,\n    onBlur\n  } = _ref;\n  const typing = shallowRef(false);\n  const focused = shallowRef(false);\n  /**\n   * We will prevent blur to handle open event when user click outside,\n   * since this will repeat trigger `onOpenChange` event.\n   */\n  const preventBlurRef = shallowRef(false);\n  const valueChangedRef = shallowRef(false);\n  const preventDefaultRef = shallowRef(false);\n  const inputProps = computed(() => ({\n    onMousedown: () => {\n      typing.value = true;\n      triggerOpen(true);\n    },\n    onKeydown: e => {\n      const preventDefault = () => {\n        preventDefaultRef.value = true;\n      };\n      onKeydown(e, preventDefault);\n      if (preventDefaultRef.value) return;\n      switch (e.which) {\n        case KeyCode.ENTER:\n          {\n            if (!open.value) {\n              triggerOpen(true);\n            } else if (onSubmit() !== false) {\n              typing.value = true;\n            }\n            e.preventDefault();\n            return;\n          }\n        case KeyCode.TAB:\n          {\n            if (typing.value && open.value && !e.shiftKey) {\n              typing.value = false;\n              e.preventDefault();\n            } else if (!typing.value && open.value) {\n              if (!forwardKeydown(e) && e.shiftKey) {\n                typing.value = true;\n                e.preventDefault();\n              }\n            }\n            return;\n          }\n        case KeyCode.ESC:\n          {\n            typing.value = true;\n            onCancel();\n            return;\n          }\n      }\n      if (!open.value && ![KeyCode.SHIFT].includes(e.which)) {\n        triggerOpen(true);\n      } else if (!typing.value) {\n        // Let popup panel handle keyboard\n        forwardKeydown(e);\n      }\n    },\n    onFocus: e => {\n      typing.value = true;\n      focused.value = true;\n      if (onFocus) {\n        onFocus(e);\n      }\n    },\n    onBlur: e => {\n      if (preventBlurRef.value || !isClickOutside(document.activeElement)) {\n        preventBlurRef.value = false;\n        return;\n      }\n      if (blurToCancel.value) {\n        setTimeout(() => {\n          let {\n            activeElement\n          } = document;\n          while (activeElement && activeElement.shadowRoot) {\n            activeElement = activeElement.shadowRoot.activeElement;\n          }\n          if (isClickOutside(activeElement)) {\n            onCancel();\n          }\n        }, 0);\n      } else if (open.value) {\n        triggerOpen(false);\n        if (valueChangedRef.value) {\n          onSubmit();\n        }\n      }\n      focused.value = false;\n      if (onBlur) {\n        onBlur(e);\n      }\n    }\n  }));\n  // check if value changed\n  watch(open, () => {\n    valueChangedRef.value = false;\n  });\n  watch(value, () => {\n    valueChangedRef.value = true;\n  });\n  const globalMousedownEvent = shallowRef();\n  // Global click handler\n  onMounted(() => {\n    globalMousedownEvent.value = addGlobalMousedownEvent(e => {\n      const target = getTargetFromEvent(e);\n      if (open.value) {\n        const clickedOutside = isClickOutside(target);\n        if (!clickedOutside) {\n          preventBlurRef.value = true;\n          // Always set back in case `onBlur` prevented by user\n          raf(() => {\n            preventBlurRef.value = false;\n          });\n        } else if (!focused.value || clickedOutside) {\n          triggerOpen(false);\n        }\n      }\n    });\n  });\n  onBeforeUnmount(() => {\n    globalMousedownEvent.value && globalMousedownEvent.value();\n  });\n  return [inputProps, {\n    focused,\n    typing\n  }];\n}","map":{"version":3,"names":["onBeforeUnmount","onMounted","watch","shallowRef","computed","KeyCode","addGlobalMousedownEvent","getTargetFromEvent","raf","usePickerInput","_ref","open","value","isClickOutside","triggerOpen","forwardKeydown","onKeydown","blurToCancel","onSubmit","onCancel","onFocus","onBlur","typing","focused","preventBlurRef","valueChangedRef","preventDefaultRef","inputProps","onMousedown","e","preventDefault","which","ENTER","TAB","shiftKey","ESC","SHIFT","includes","document","activeElement","setTimeout","shadowRoot","globalMousedownEvent","target","clickedOutside"],"sources":["/Users/lpl/工作/Teamsupport/develop_help/node_modules/ant-design-vue/es/vc-picker/hooks/usePickerInput.js"],"sourcesContent":["import { onBeforeUnmount, onMounted, watch, shallowRef, computed } from 'vue';\nimport KeyCode from '../../_util/KeyCode';\nimport { addGlobalMousedownEvent, getTargetFromEvent } from '../utils/uiUtil';\nimport raf from '../../_util/raf';\nexport default function usePickerInput(_ref) {\n  let {\n    open,\n    value,\n    isClickOutside,\n    triggerOpen,\n    forwardKeydown,\n    onKeydown,\n    blurToCancel,\n    onSubmit,\n    onCancel,\n    onFocus,\n    onBlur\n  } = _ref;\n  const typing = shallowRef(false);\n  const focused = shallowRef(false);\n  /**\n   * We will prevent blur to handle open event when user click outside,\n   * since this will repeat trigger `onOpenChange` event.\n   */\n  const preventBlurRef = shallowRef(false);\n  const valueChangedRef = shallowRef(false);\n  const preventDefaultRef = shallowRef(false);\n  const inputProps = computed(() => ({\n    onMousedown: () => {\n      typing.value = true;\n      triggerOpen(true);\n    },\n    onKeydown: e => {\n      const preventDefault = () => {\n        preventDefaultRef.value = true;\n      };\n      onKeydown(e, preventDefault);\n      if (preventDefaultRef.value) return;\n      switch (e.which) {\n        case KeyCode.ENTER:\n          {\n            if (!open.value) {\n              triggerOpen(true);\n            } else if (onSubmit() !== false) {\n              typing.value = true;\n            }\n            e.preventDefault();\n            return;\n          }\n        case KeyCode.TAB:\n          {\n            if (typing.value && open.value && !e.shiftKey) {\n              typing.value = false;\n              e.preventDefault();\n            } else if (!typing.value && open.value) {\n              if (!forwardKeydown(e) && e.shiftKey) {\n                typing.value = true;\n                e.preventDefault();\n              }\n            }\n            return;\n          }\n        case KeyCode.ESC:\n          {\n            typing.value = true;\n            onCancel();\n            return;\n          }\n      }\n      if (!open.value && ![KeyCode.SHIFT].includes(e.which)) {\n        triggerOpen(true);\n      } else if (!typing.value) {\n        // Let popup panel handle keyboard\n        forwardKeydown(e);\n      }\n    },\n    onFocus: e => {\n      typing.value = true;\n      focused.value = true;\n      if (onFocus) {\n        onFocus(e);\n      }\n    },\n    onBlur: e => {\n      if (preventBlurRef.value || !isClickOutside(document.activeElement)) {\n        preventBlurRef.value = false;\n        return;\n      }\n      if (blurToCancel.value) {\n        setTimeout(() => {\n          let {\n            activeElement\n          } = document;\n          while (activeElement && activeElement.shadowRoot) {\n            activeElement = activeElement.shadowRoot.activeElement;\n          }\n          if (isClickOutside(activeElement)) {\n            onCancel();\n          }\n        }, 0);\n      } else if (open.value) {\n        triggerOpen(false);\n        if (valueChangedRef.value) {\n          onSubmit();\n        }\n      }\n      focused.value = false;\n      if (onBlur) {\n        onBlur(e);\n      }\n    }\n  }));\n  // check if value changed\n  watch(open, () => {\n    valueChangedRef.value = false;\n  });\n  watch(value, () => {\n    valueChangedRef.value = true;\n  });\n  const globalMousedownEvent = shallowRef();\n  // Global click handler\n  onMounted(() => {\n    globalMousedownEvent.value = addGlobalMousedownEvent(e => {\n      const target = getTargetFromEvent(e);\n      if (open.value) {\n        const clickedOutside = isClickOutside(target);\n        if (!clickedOutside) {\n          preventBlurRef.value = true;\n          // Always set back in case `onBlur` prevented by user\n          raf(() => {\n            preventBlurRef.value = false;\n          });\n        } else if (!focused.value || clickedOutside) {\n          triggerOpen(false);\n        }\n      }\n    });\n  });\n  onBeforeUnmount(() => {\n    globalMousedownEvent.value && globalMousedownEvent.value();\n  });\n  return [inputProps, {\n    focused,\n    typing\n  }];\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}